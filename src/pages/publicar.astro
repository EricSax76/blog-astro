---
import Layout from "../layouts/Layout.astro";

const firebaseConfig = {
  apiKey: import.meta.env.PUBLIC_FIREBASE_API_KEY ?? "",
  authDomain: import.meta.env.PUBLIC_FIREBASE_AUTH_DOMAIN ?? "",
  projectId: import.meta.env.PUBLIC_FIREBASE_PROJECT_ID ?? "",
  storageBucket: import.meta.env.PUBLIC_FIREBASE_STORAGE_BUCKET ?? "",
  messagingSenderId: import.meta.env.PUBLIC_FIREBASE_MESSAGING_SENDER_ID ?? "",
  appId: import.meta.env.PUBLIC_FIREBASE_APP_ID ?? "",
};
---

<Layout title="Publicar | El Alma de las Flores">
  <section class="text-center space-y-4">
    <p class="text-xs uppercase tracking-[0.3em] text-deep-green/60 font-semibold">
      Panel de autor
    </p>
    <h1 class="font-serif text-4xl md:text-5xl font-bold text-deep-green">
      Publicar en el blog
    </h1>
    <p class="text-deep-green/70 text-lg max-w-3xl mx-auto">
      Esta zona está protegida por sesión. Solo usuarios autenticados pueden crear
      nuevas entradas.
    </p>
  </section>

  <section
    class="mt-12 bg-white/85 border border-sage/20 rounded-[2.2rem] shadow-xl shadow-sage/5 p-7 md:p-10 space-y-6"
  >
    <div class="space-y-4">
      <p
        id="publish-auth-config-warning"
        class="hidden rounded-2xl border border-amber-300/60 bg-amber-50 px-4 py-3 text-sm text-amber-800"
      >
        Falta configurar Firebase en variables `PUBLIC_FIREBASE_*`.
      </p>

      <div
        id="publish-auth-state"
        class="rounded-2xl border border-sage/25 bg-cream/70 px-4 py-3 text-sm text-deep-green/80 flex flex-wrap items-center justify-between gap-3"
      >
        <span>Sesión activa: <strong id="publish-auth-email">verificando...</strong></span>
        <button
          id="publish-logout-button"
          type="button"
          class="rounded-full border border-sage/40 px-4 py-2 text-xs font-semibold text-deep-green hover:bg-sage/10 transition-colors"
        >
          Cerrar sesión
        </button>
      </div>

      <p
        id="publish-locked-message"
        class="rounded-2xl border border-sage/25 bg-cream/70 px-4 py-3 text-sm text-deep-green/80"
      >
        Debes iniciar sesión para publicar. <a href="/#login" class="underline font-semibold">Ir a acceso</a>
      </p>
    </div>

    <form id="blog-form" class="space-y-5 opacity-60 transition-opacity" aria-describedby="blog-help">
      <label class="block space-y-2">
        <span class="text-xs uppercase tracking-[0.2em] text-deep-green/60 font-semibold">
          Título
        </span>
        <input
          id="blog-title"
          data-publish-control
          type="text"
          name="title"
          disabled
          placeholder="Ej: Flores que inspiran calma"
          class="w-full rounded-2xl border border-sage/30 bg-cream/60 px-4 py-3 text-base text-deep-green placeholder:text-deep-green/40 focus:outline-none focus:ring-2 focus:ring-sage/40 disabled:opacity-50 disabled:cursor-not-allowed"
        />
      </label>

      <label class="block space-y-2">
        <span class="text-xs uppercase tracking-[0.2em] text-deep-green/60 font-semibold">
          Contenido
        </span>
        <textarea
          id="blog-content"
          data-publish-control
          name="content"
          rows="6"
          disabled
          placeholder="Comparte la historia, reflexión o enseñanza del día..."
          class="w-full rounded-2xl border border-sage/30 bg-cream/60 px-4 py-3 text-base text-deep-green placeholder:text-deep-green/40 focus:outline-none focus:ring-2 focus:ring-sage/40 disabled:opacity-50 disabled:cursor-not-allowed"
        ></textarea>
      </label>

      <label class="block space-y-2">
        <span class="text-xs uppercase tracking-[0.2em] text-deep-green/60 font-semibold">
          Foto destacada
        </span>
        <input
          id="blog-image-input"
          data-publish-control
          type="file"
          name="image"
          accept="image/*"
          disabled
          class="block w-full text-sm text-deep-green file:mr-4 file:rounded-full file:border-0 file:bg-sage/20 file:px-4 file:py-2 file:font-semibold file:text-deep-green hover:file:bg-sage/30 disabled:opacity-50 disabled:cursor-not-allowed"
        />
      </label>

      <div class="rounded-2xl border border-sage/20 bg-cream/50 p-4 space-y-3">
        <p class="text-xs uppercase tracking-[0.2em] text-deep-green/60 font-semibold">
          Vista previa
        </p>
        <img
          id="blog-image-preview"
          class="hidden h-48 w-full rounded-2xl object-cover"
          alt="Vista previa de la imagen seleccionada"
        />
        <p id="blog-image-placeholder" class="text-sm text-deep-green/60">
          Selecciona una imagen para verla aquí.
        </p>
      </div>

      <div class="flex flex-wrap gap-3">
        <button
          type="button"
          id="blog-publish-button"
          data-publish-control
          disabled
          class="rounded-full bg-deep-green px-6 py-3 text-cream font-semibold shadow-lg shadow-sage/20 transition-transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Publicar
        </button>
        <button
          type="button"
          id="blog-go-2026"
          class="rounded-full border border-sage/40 px-6 py-3 font-semibold text-deep-green hover:bg-sage/10 transition-colors"
        >
          Ir al 2026
        </button>
      </div>

      <p id="blog-help" class="text-sm text-deep-green/60">
        Al publicar, el contenido se guarda y aparece en el archivo 2026.
      </p>
    </form>
  </section>
</Layout>

<script is:inline define:vars={{ firebaseConfig }}>
  window.__FIREBASE_CONFIG__ = firebaseConfig;
  window.__BLOG_AUTH_STATE__ = { isAuthenticated: false, email: null };
</script>
<script src="../scripts/publish-auth.js"></script>
<script src="../scripts/blog-logic.ts"></script>
