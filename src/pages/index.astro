---
import Layout from "../layouts/Layout.astro";

const firebaseConfig = {
  apiKey: import.meta.env.PUBLIC_FIREBASE_API_KEY ?? "",
  authDomain: import.meta.env.PUBLIC_FIREBASE_AUTH_DOMAIN ?? "",
  projectId: import.meta.env.PUBLIC_FIREBASE_PROJECT_ID ?? "",
  storageBucket: import.meta.env.PUBLIC_FIREBASE_STORAGE_BUCKET ?? "",
  messagingSenderId: import.meta.env.PUBLIC_FIREBASE_MESSAGING_SENDER_ID ?? "",
  appId: import.meta.env.PUBLIC_FIREBASE_APP_ID ?? "",
};
---

<Layout title="Entrada al Blog | El Alma de las Flores">
  <section class="text-center space-y-4">
    <p class="text-xs uppercase tracking-[0.3em] text-deep-green/60 font-semibold">
      Portal de autores
    </p>
    <h1 class="font-serif text-4xl md:text-5xl font-bold text-deep-green">
      Bienvenido a El Alma de las Flores
    </h1>
    <p class="text-deep-green/70 text-lg max-w-3xl mx-auto">
      Regístrate o inicia sesión para publicar nuevas entradas del blog y mantener
      actualizado el anuario 2026.
    </p>
  </section>

  <section class="mt-12 max-w-2xl mx-auto">
    <article
      class="bg-white/85 border border-sage/20 rounded-[2.2rem] shadow-xl shadow-sage/5 p-7 md:p-10 space-y-6"
    >
      <header class="space-y-3">
        <h2 class="font-serif text-3xl md:text-4xl font-bold text-deep-green">
          Acceso de usuario
        </h2>
        <p class="text-deep-green/70">
          Al registrarte se crea tu cuenta en Authentication y tu perfil en la
          base de datos (<code>users/&#123;uid&#125;</code>).
        </p>
      </header>

      <p
        id="auth-config-warning"
        class="hidden rounded-2xl border border-amber-300/60 bg-amber-50 px-4 py-3 text-sm text-amber-800"
      >
        Falta configurar Firebase en variables `PUBLIC_FIREBASE_*` para usar el acceso.
      </p>

      <p
        id="auth-message"
        class="hidden rounded-2xl border px-4 py-3 text-sm"
        role="status"
        aria-live="polite"
      ></p>

      <div id="auth-guest" class="space-y-8">
        <section id="registro" class="space-y-4">
          <h3 class="font-serif text-2xl font-semibold text-deep-green">
            Crear cuenta
          </h3>
          <form id="register-form" class="space-y-4">
            <label class="block space-y-2">
              <span class="text-xs uppercase tracking-[0.2em] text-deep-green/60 font-semibold">
                Nombre
              </span>
              <input
                type="text"
                name="name"
                autocomplete="name"
                placeholder="Tu nombre"
                class="w-full rounded-2xl border border-sage/30 bg-cream/60 px-4 py-3 text-deep-green placeholder:text-deep-green/40 focus:outline-none focus:ring-2 focus:ring-sage/40"
              />
            </label>

            <label class="block space-y-2">
              <span class="text-xs uppercase tracking-[0.2em] text-deep-green/60 font-semibold">
                Correo
              </span>
              <input
                type="email"
                name="email"
                autocomplete="email"
                required
                placeholder="nombre@correo.com"
                class="w-full rounded-2xl border border-sage/30 bg-cream/60 px-4 py-3 text-deep-green placeholder:text-deep-green/40 focus:outline-none focus:ring-2 focus:ring-sage/40"
              />
            </label>

            <label class="block space-y-2">
              <span class="text-xs uppercase tracking-[0.2em] text-deep-green/60 font-semibold">
                Contraseña
              </span>
              <input
                type="password"
                name="password"
                autocomplete="new-password"
                minlength="6"
                required
                placeholder="Mínimo 6 caracteres"
                class="w-full rounded-2xl border border-sage/30 bg-cream/60 px-4 py-3 text-deep-green placeholder:text-deep-green/40 focus:outline-none focus:ring-2 focus:ring-sage/40"
              />
            </label>

            <label class="block space-y-2">
              <span class="text-xs uppercase tracking-[0.2em] text-deep-green/60 font-semibold">
                Confirmar contraseña
              </span>
              <input
                type="password"
                name="confirmPassword"
                autocomplete="new-password"
                minlength="6"
                required
                placeholder="Repite la contraseña"
                class="w-full rounded-2xl border border-sage/30 bg-cream/60 px-4 py-3 text-deep-green placeholder:text-deep-green/40 focus:outline-none focus:ring-2 focus:ring-sage/40"
              />
            </label>

            <button
              type="submit"
              class="w-full rounded-full bg-deep-green px-6 py-3 text-cream font-semibold shadow-lg shadow-sage/20 hover:bg-deep-green/90 transition-colors"
            >
              Registrarme
            </button>
          </form>
        </section>

        <div class="h-px bg-sage/20"></div>

        <section id="login" class="space-y-4">
          <h3 class="font-serif text-2xl font-semibold text-deep-green">
            Iniciar sesión
          </h3>
          <form id="login-form" class="space-y-4">
            <label class="block space-y-2">
              <span class="text-xs uppercase tracking-[0.2em] text-deep-green/60 font-semibold">
                Correo
              </span>
              <input
                type="email"
                name="email"
                autocomplete="email"
                required
                placeholder="nombre@correo.com"
                class="w-full rounded-2xl border border-sage/30 bg-cream/60 px-4 py-3 text-deep-green placeholder:text-deep-green/40 focus:outline-none focus:ring-2 focus:ring-sage/40"
              />
            </label>

            <label class="block space-y-2">
              <span class="text-xs uppercase tracking-[0.2em] text-deep-green/60 font-semibold">
                Contraseña
              </span>
              <input
                type="password"
                name="password"
                autocomplete="current-password"
                required
                placeholder="Tu contraseña"
                class="w-full rounded-2xl border border-sage/30 bg-cream/60 px-4 py-3 text-deep-green placeholder:text-deep-green/40 focus:outline-none focus:ring-2 focus:ring-sage/40"
              />
            </label>

            <button
              type="submit"
              class="w-full rounded-full border border-sage/40 px-6 py-3 text-deep-green font-semibold hover:bg-sage/10 transition-colors"
            >
              Entrar al panel
            </button>
          </form>
        </section>
      </div>

      <section
        id="auth-user"
        class="hidden rounded-3xl border border-sage/30 bg-cream/70 p-6 space-y-4"
      >
        <p class="text-xs uppercase tracking-[0.2em] text-deep-green/60 font-semibold">
          Sesión activa
        </p>
        <p class="text-deep-green/80">
          Conectado como <strong id="auth-user-email"></strong>
        </p>
        <div class="flex flex-wrap gap-3">
          <a
            href="/publicar"
            class="rounded-full bg-deep-green px-5 py-2 text-sm font-semibold text-cream hover:bg-deep-green/90 transition-colors"
          >
            Ir a escribir
          </a>
          <button
            id="logout-button"
            type="button"
            class="rounded-full border border-sage/40 px-5 py-2 text-sm font-semibold text-deep-green hover:bg-sage/10 transition-colors"
          >
            Cerrar sesión
          </button>
        </div>
      </section>
    </article>
  </section>
</Layout>

<script is:inline define:vars={{ firebaseConfig }}>
  window.__FIREBASE_CONFIG__ = firebaseConfig;
  window.__BLOG_AUTH_STATE__ = { isAuthenticated: false, email: null };
</script>
<script src="../scripts/entry-auth.js"></script>
