---
import Layout from "../../layouts/Layout.astro";
import YearbookNav from "../../components/YearbookNav.astro";
import posts from "../../data/posts.json";

// Define the type for better TS support within the Astro component
type BlogPost = {
  id: number;
  title: string;
  content: string;
  image: string;
  createdAt: string;
};

// Explicitly cast the imported JSON to the proper type
const blogPosts = posts as BlogPost[];

const formatDate = (iso: string): string => {
  if (!iso) return "";
  const date = new Date(iso);
  if (Number.isNaN(date.getTime())) return "";
  return date.toLocaleDateString("es-ES", {
    day: "2-digit",
    month: "long",
    year: "numeric",
  });
};
---

<Layout title="Anuario 2026 | El Alma de las Flores">
  <main class="max-w-4xl mx-auto px-6 py-12 md:py-20">
    <div class="text-center mb-16 space-y-4">
      <h1 class="font-serif text-5xl md:text-6xl font-bold text-deep-green">
        Anuario 2026
      </h1>
      <p class="text-xl text-deep-green/60 italic font-serif">
        Un espacio para las nuevas entradas del año.
      </p>
    </div>

    <YearbookNav activeYear={2026} />

    <div id="posts-grid" class="grid gap-12">
      {
        blogPosts.length === 0 ? (
          <article
            id="posts-placeholder"
            class="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-xl shadow-sage/5 border border-sage/10"
          >
            <header class="mb-6 text-center">
              <h2 class="font-serif text-3xl md:text-4xl font-bold text-deep-green">
                Próximamente
              </h2>
              <p class="text-sm text-deep-green/60 italic font-serif">
                Aquí aparecerán los posts publicados en 2026.
              </p>
            </header>

            <div class="prose prose-lg prose-headings:font-serif prose-headings:text-deep-green text-deep-green/80 leading-relaxed max-w-none">
              <p>
                Este espacio está listo para recibir tus nuevos textos,
                reflexiones y fotografías. Cada entrada que publiques durante
                2026 podrá vivir aquí, organizada dentro del archivo anual.
              </p>
              <p>
                Cuando tengas un nuevo post, añade el contenido y la imagen
                destacada para mantener el anuario actualizado.
              </p>
            </div>
          </article>
        ) : (
          blogPosts.map((post) => (
            <article class="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-xl shadow-sage/5 border border-sage/10">
              <header class="mb-6 text-center">
                <h2 class="font-serif text-3xl md:text-4xl font-bold text-deep-green">
                  {post.title?.trim() || "Entrada sin título"}
                </h2>
                {post.createdAt && (
                  <p class="text-sm text-deep-green/60 italic font-serif">
                    {formatDate(post.createdAt)}
                  </p>
                )}
              </header>

              {post.image && (
                <div class="mb-8 overflow-hidden rounded-2xl border border-sage/10 shadow-lg">
                  <img
                    src={post.image}
                    alt={post.title?.trim() || "Imagen del post"}
                    class="h-64 md:h-80 w-full object-cover"
                  />
                </div>
              )}

              <div class="prose prose-lg prose-headings:font-serif prose-headings:text-deep-green text-deep-green/80 leading-relaxed max-w-none">
                {post.content?.trim() ? (
                  post.content
                    .split(/\n+/)
                    .map((paragraph) => <p>{paragraph.trim()}</p>)
                ) : (
                  <p>Este post no tiene contenido escrito.</p>
                )}
              </div>
            </article>
          ))
        )
      }
    </div>
  </main>
</Layout>
